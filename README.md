#SystemIdent
store systemIdent File

System Identification on Smartwheel Wheelchair
Purpose
The purpose of system identification on Smartwheel wheelchair is to estimate dynamic properties of a wheelchair using experimental/empirical data. The dynamic properties, especially rotational moment of inertia, of an occupied wheelchair is usually difficult to measure and is influenced by users. However, the torque applied and angular velocity are easier to measure and calculate with smartwheels and IMU. The matlab system identification tool allows inputting measured data and estimates the dynamic model of the wheelchair system. The results can be used to calculate rotational moment of inertia with known mass of wheelchair and user. With these estimated dynamic properties, we can obtain the wheelchair user's dynamic profile with only kinematic and kinetic data and provide further assistance to design controllers that can detect users' intention.
 
Approach
Data preparation:
We use MATLAB system identification as our main tool and data collected from Smartwheels as the source data. The source data are generated by user doing different maneuvers. During trials, Smartwheels collect real time kinematic and kinetic data, including angular and linear velocity of each wheel, and torque applied at each wheel by the user. The angular and linear velocity of wheelchair can be calculated using wheel velocity. We started system identification with straight forward trials, 90 degree turn trials, and 180 degree turn trials on level ground to test the system identification method, each maneuver containing 3 trials. We have collected data from two experienced users. We suppose that the dynamic model of two users is distinct, so we combined the data of selected trials separately for each user, with two thirds of trials as estimation data and one third as validation data. If the final results of two users' dynamic model are similar, we can conduct the system identification again with two users' data combined together.  
 
MATLAB system identification model:
Ideally, we want to predict user’s motion through torque applied by user. To begin with system identification, we selected the torque data of each wheel as input and velocity data as output for estimation. MATLAB system identification provides many different models for estimation. We explored different types of model by comparing by comparing simulated output with measured data. In addition, looking at residuals to evaluate the significance(!!) of the model. Under each model, we tested various order of the system to find out the most accurate representation. The MATLAB tool will output matrices that represent the selected dynamic model.
 
Dynamic model derivation:
After determining the best model and the order of the system, we derive the dynamic model of the occupied wheelchair using langranian theory based on the selected model in MATLAB. [The results give out matrices of the wheelchair model in parameters of mass, moment of inertia, and angular velocity, etc. Mapping the derived matrices with the estimated matrices, we can calculate the rotational moment of inertia of the occupied Smartwheel wheelchair with known mass.]
 
Verification of system identification:
We verify the estimated moment of inertia in two ways. First, we compare the result with realized moment of inertia of Smartwheel wheelchair in references. Second, we generate a series of artificial data using gazebo and analyze the data using the same method. Then compare the calculated moment of inertia with the known wheelchair model.
 
Results
System Identification
We combined and preprocessed data using the MATLAB code in Figure X, and conduct system identification using MATLAB code in figure X. The preprocessed data include wheel angular velocity of each side, torque applied at each side, and linear and angular velocity of the wheelchair. 

After importing combined data as time domain series, we set two thirds of trials as estimation data and one third as validation data. Initially, we take torque data as input and take linear and angular velocity of the wheelchair as output, then test Tranfer Function model, State Space model, Process model, polynominal model, and Non-linear model. The simulated response output from estimation data set are present in Figure X, and the fitness value of each model is shown besides the graph. Figure X is simulated response output from validation data set. 

By comparing the simulated response output with measured data, we can tell that Transfer Function model in second order fits data the best, followed by State Space model and Process model. 

Transfer Function model estimates 
State Space model, although with a relatively lower score, predicted each output property considering the overall characteristics of two inputs. From the output diagram, the lower score is due to bad performance when angular velocity oscillates around zero, but the 

The State Space model is in the format of dx/dt = Ax(t)+Bu(t)+Ke(t) and y(t) = Cx(t)+Du(t)+e(t), and MATLAB estimates the value of each parameter. X(t) is the matrix of states of the system and y(t) is the matrix of the output, which is the angular velocity of right and left wheel. U(t) is the input matrix, which is torque applied at right and left wheel. The values of parameters are given in matrix form, shown in figure X below. 

To derive the dynamic model, we follow “dynamic modelling …” and apply langranian theory. Then we obtained the model equation, referring to equation (47) in “”. The wheelchair dynamics are expressed in wheelchair linear and angular velocity (v, w), and right and left torques (TL, TR). However, the equation involves w^2 and wv, which are non-linear, and we cannot apply MATLAB results to solve dynamic properties. 

The other dynamic equation we derive from right and left wheel angular velocities (WR,WL), wheelchair angular velocity, and torques applying langranian theory is linear. Therefore, we decide to take wheel angular velocity as output data, and apply State Space model again to get parameter values. Mapping the matrix value to matrix represented in dynamic characteristics in equation (46), we can calculate the value of unknown dynamic property, rotational moment of inertia.

After importing torque data as input and wheel angular velocity as output in MATLAB, we again use State Space model in second order to estimate the dynamic model. The simulated response output is shown in Figure X. Zooming the output graph, the simulation performs poor when angular velocity oscillates around 0, but it characterizes peak angular velocity well. 

The derived dynamic equation are in the form of equation (46), shown in figure X. In the equation , vector n is [WR, WL], and we need to switch the matrix column to match the input wheel angular velocity data in MATLAB, which is [WL,WR]. Substitute y(t) = Cx(t)+Du(t)+e(t) into dx/dt = Ax(t)+Bu(t)+Ke(t), and rearrange equation to the form of equation (46), we can solve [insert Matrix equation] with known parameters R, L, m…to get rotational moment of inertia. The results of moment of inertia calculated by MATLAB are XXX and XXX for two users.
  


Results Verification

Discussion

Conclusion



System identification code
%% clear workspace and close all figs
clc
clear all
close all

%% Selecting IMU/SW measurements to import
d = dir;
fn = {d.name};

DataSet_EST = readtable('Estimation_Mahsa.xls');
DataSet_VAL = readtable('Validation_Mahsa.xls');

EST.input = table2array(DataSet_EST(:,6:7));
EST.output = table2array(DataSet_EST(:,4:5));
%EST.LV = table2array(DataSet_EST(:,4));
%EST.AV = table2array(DataSet_EST(:,5));

VAL.input = table2array(DataSet_VAL(:,6:7));
VAL.output = table2array(DataSet_VAL(:,4:5)); %column4 -LinVel; Column5-AngVel;
%VAL.LV = table2array(DataSet_VAL(:,4));
%VAL.AV = table2array(DataSet_VAL(:,5));

systemIdentification



%% Instruction
% 
% # ITEM1 import estimation data as data_est: import time domain data -->
% input:EST.input;  output:EST.output; StartTime:0; Period: 1/240
   
% # ITEM2 import validation data as data_val:
% input:VAL.input;  output:VAL.output; StartTime:0; Period: 1/240

%check time plots box to see the time plots, can also check transient
%response to see the trend

% # ITEM3 Estimate using state space model--> change Model Order from 1 to
% 6 (2 is the best) --> create six model outputs; 

% # ITEM4 Can refine the 2nd order model by setting model order as 2 and
% select PEM under estimation option from estimation method
 
% # ITEM5 check Model Output to compare results --> I select "5 ahead step
% predicted output" under "Option" of model output window and set the step
% size as 1 to evaluate the predicting ability; 
% switch chanel to see fits for two different outputs
% can also check error plot and confidance level under option

% # ITEM6 check model residual --> display confidance level under option, 
% or switch channel for different output

% # ITEM6 drag data_val from Data views to Validation Data and check model output window
% select "Simulated Output" under "Option" of model output window to see
% simulated fits results, switch channel to see different output results
% can also check confidance level and error plot

% # ITEM7 check model residual, zeros and poles (99%confidence under
% option)

%# ITEM8 Export model to workspace...








